"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var apiService;class SpreadSheetApp{constructor(accessToken){this.accessToken=accessToken}openById(id,ignoreCache){apiService=new ApiService(this.accessToken,"https://sheets.googleapis.com/v4/spreadsheets/"+id);var metadata;if(typeof ignoreCache!=="boolean"||ignoreCache===false){var _scriptCache=CacheService.getScriptCache();var cached=JSON.parse(_scriptCache.get("cached"+id));if(cached){return new SpreadSheet(cached)}}metadata=apiService.get("");var scriptCache=CacheService.getScriptCache();scriptCache.put("cached"+id,JSON.stringify(_objectSpread({},metadata,{properties:{}})),21600);return new SpreadSheet(metadata)}}exports.default=SpreadSheetApp;class SpreadSheet{constructor(data){this.data=data;this.id=data.spreadsheetId}batchUpdate(requests){if(!Array.isArray(requests))requests=[requests];var res=apiService.post(":batchUpdate",{requests});return res.replies}getSheetByName(sheetName){var sheetData=this.data.sheets.find(s=>s.properties.title===sheetName);if(!sheetData)return null;return new Sheet(sheetData,this)}getSheets(){return this.data.sheets.map(s=>new Sheet(s))}insertSheet(title){var res=this.batchUpdate({addSheet:{properties:{title}}});return new Sheet(res.addSheet,this)}}class Sheet{constructor(_ref,SpreadSheet){var{properties}=_ref;this.properties=properties;this.id=properties.sheetId;this.SpreadSheet=SpreadSheet}updateProperties(updateObj){this.SpreadSheet.batchUpdate({updateSheetProperties:{fields:"*",properties:_objectSpread({},this.properties,{},updateObj)}})}getLastColumn(){return this.properties.gridProperties.columnCount}getLastRow(){return this.properties.gridProperties.rowCount}hideSheet(){if(this.properties.hidden)return;this.updateProperties({hidden:true})}getName(){return this.properties.title}getRange(rowOrA1Notation,col,numRows,numCols){var a1Notation;if(!isFinite(+rowOrA1Notation)){a1Notation=rowOrA1Notation}else{var row=rowOrA1Notation;a1Notation="".concat(colNumberToLabel(col)).concat(row,":").concat(colNumberToLabel(numCols?col+numCols-1:this.getLastColumn())).concat(row+numRows-1)}return new Range(a1Notation,this)}getDataRange(){return this.getRange("A1:".concat(colNumberToLabel(this.getLastColumn())))}appendRow(row){apiService.post("/values/".concat(this.properties.title,":append?valueInputOption=USER_ENTERED"),{values:[row]})}deleteRow(row){this.SpreadSheet.batchUpdate({deleteDimension:{range:{dimension:"ROWS",sheetId:this.id,startIndex:row-1,endIndex:row}}})}}class Range{constructor(a1Notation,Sheet){this.a1Notation=a1Notation;this.Sheet=Sheet}getValues(){var res=apiService.get("/values/".concat(this.Sheet.properties.title,"!").concat(this.a1Notation,"?valueRenderOption=UNFORMATTED_VALUE"));return res.values||[]}getValue(){return this.getValues()[0][0]}setValue(value){this.setValues([[value]])}setValues(values){apiService.put("/values/".concat(this.Sheet.properties.title,"!").concat(this.a1Notation,"?valueInputOption=USER_ENTERED"),{values})}setFormula(formula){this.setValue(formula)}}class ApiService{constructor(accessToken,baseUrl){this.token=accessToken;this.baseUrl=baseUrl||""}get(url,options){var res=UrlFetchApp.fetch(this.baseUrl+url,_objectSpread({headers:{Authorization:"Bearer "+this.token}},options));var json=JSON.parse(res.getContentText());if(json.error)throw json.error;return json}post(url,payload,options){var res=UrlFetchApp.fetch(this.baseUrl+url,_objectSpread({method:"post",headers:{Authorization:"Bearer "+this.token},payload:JSON.stringify(payload||{}),contentType:"application/json"},options));var json=JSON.parse(res.getContentText());if(json.error)throw json.error;return json}put(url,payload,options){return this.post(url,payload,_objectSpread({method:"put"},options))}}function colNumberToLabel(num){var str="";while(num>0){var rem=(num-1)%26;num=Math.floor((num-1)/26);str=String.fromCharCode(65+rem)+str}return str}